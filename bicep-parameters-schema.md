# Azure Bicep File Documentation

This document provides documentation for the Azure Bicep Parameters file located at [`src/parameters/main.bicepparam`](/src/parameters/main.bicepparam). The Bicep parameters file defines the infrastructure required for the environment and sets various parameters. Below, we provide details about the parameters, variables, and resources defined in the Bicep file.

## Parameters

### `settings`

- `subscriptionId`: A string representing the Azure Subscription ID. This is generated by deploy script
- `tenantId`: A string representing the Azure Entra ID tenant ID. This is generated by deploy script
- `demoName`: A string representing the name of the demo (default: 'devcloud-demo').
- `location`: A string representing the Azure region (default: 'eastus').
- `githubPat`: A GitHub Personal Access Token (PAT) used for authentication with repos.
- `tags`: A dictionary of tags, with the option to specify 'delete' as `true` (default: 'delete': true) as well as envname, which will be populated to the value of `demoName`. This is used to delete environments that are no longer needed.
- `environmentTypes`: An array of environment types, used at Dev Center and Project level, each containing:
  - `name`: A string representing the environment name (e.g., 'Dev', 'Test', 'Prod').
  - `subscriptionId`: A string representing the Azure Subscription ID for the environment.
  - `servicePrincipalId`: A string representing the Service Principal ID for the environment. This is generated by deploy script

### `networks`

- An array of network definitions, each containing:
  - `name`: A string representing the name of the network.
  - `addressPrefixes`: An array of address prefixes (CIDRs) for the network.
  - `subnetAddressPrefix`: A string representing the address prefix (CIDR) for the network's subnets.
  - `location`: A string representing the Azure region for the network.

### `devBoxDefs`
For more information about Dev Box Definitions, you can use the scripts in the *Getting Values* section, as well as inspect the [`scr/modules/devcenter/devboxDefinition.bicep` file](/src/modules/devcenter/devboxDefinition.bicep)
- An array of Microsoft Dev Box definitions, each containing:
  - `name`: A string representing the name of the development box.
  - `compute`: A string describing the compute specifications.
  - `storage`: A string describing the storage specifications.
  - `galleryName`: A string representing the gallery name. (Default is `default`)
  - `imageName`: A string representing the image name.

### `userRoles`

- An array of user role definitions, each containing:
  - `userId`: A string representing the user's ID.
  - `name`: A string representing the user's name.
  - `roles`: An array of roles assigned to the user (e.g., 'ProjectAdmin', 'DevBoxUser', 'EnvironmentsUser').

### `catalog`

- A dictionary defining catalog information with the following properties:
  - `name`: A string representing the catalog name.
  - `gitHubOrg`: A string representing the GitHub organization.
  - `gitHubRepo`: A string representing the GitHub repository.
  - `catalogItem`: A string representing the catalog item.
  - `branch`: A string representing the Git branch.
  - `path`: A string representing the path to the catalog item in the GitHub repository.

## Getting values

Here are some helpful Azure CLI scripts to populate values if you choose not to use the defaults. To use these scripts, you must have a Dev Center already created.

```bash
# Get Galleries for Dev Center
az devcenter admin gallery list --dev-center build-tour-devcenter --resource-group build-tour-devcenter -o table

# Get Images for Dev Center
az devcenter admin image list --dev-center build-tour-devcenter --resource-group build-tour-devcenter -o table

# Get SKUs available
az devcenter admin sku list -o table
```

## Usage

You can use this Bicep file to deploy and manage the resources described in the parameters and variables. You can customize the values of the parameters to match your specific environment and project requirements.

To deploy this Bicep file, you can use the Azure CLI or Azure PowerShell. Make sure you have the necessary authentication and permissions in your Azure subscription.

For example, to deploy the Bicep file using the Azure CLI:

```bash
az deployment group create --resource-group <resource-group-name> --template-file ../main.bicep --parameters settings=<parameter-values>
```

Replace <resource-group-name> and <parameter-values> with appropriate values.

> [!NOTE]
> Ensure that you have the Azure CLI and Azure PowerShell tools installed and properly configured before deploying the Bicep file.

For more information on Azure Bicep and deployment, refer to the [Azure Bicep documentation](https://learn.microsoft.com/en-us/azure/azure-resource-manager/bicep/).